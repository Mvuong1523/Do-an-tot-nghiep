# HÆ°á»›ng dáº«n quáº£n lÃ½ nhiá»u tÃ i khoáº£n ngÃ¢n hÃ ng vá»›i SePay

## ğŸ¯ Tá»•ng quan

Há»‡ thá»‘ng Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»ƒ há»— trá»£ quáº£n lÃ½ nhiá»u tÃ i khoáº£n ngÃ¢n hÃ ng vÃ  lÆ°u trá»¯ thÃ´ng tin SePay riÃªng cho tá»«ng tÃ i khoáº£n.

## âš ï¸ LÆ°u Ã½ quan trá»ng vá» SePay

**SePay KHÃ”NG Tá»° Äá»˜NG Ä‘Äƒng kÃ½ tÃ i khoáº£n ngÃ¢n hÃ ng!**

- Má»—i tÃ i khoáº£n ngÃ¢n hÃ ng cáº§n Ä‘Æ°á»£c Ä‘Äƒng kÃ½ **THá»¦ CÃ”NG** trÃªn website SePay
- Sau khi Ä‘Äƒng kÃ½, báº¡n sáº½ nháº­n Ä‘Æ°á»£c:
  - **API Token**: DÃ¹ng Ä‘á»ƒ xÃ¡c thá»±c webhook
  - **Merchant ID**: ID Ä‘á»‹nh danh merchant (tÃ¹y chá»n)
- Chá»‰ cÃ¡c tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ trÃªn SePay má»›i nháº­n Ä‘Æ°á»£c webhook khi cÃ³ giao dá»‹ch

## ğŸ“‹ Quy trÃ¬nh sá»­ dá»¥ng

### BÆ°á»›c 1: ÄÄƒng kÃ½ tÃ i khoáº£n trÃªn SePay

1. Truy cáº­p website SePay: https://sepay.vn
2. ÄÄƒng kÃ½ tÃ i khoáº£n merchant
3. ThÃªm tÃ i khoáº£n ngÃ¢n hÃ ng cá»§a báº¡n vÃ o SePay
4. Láº¥y **API Token** vÃ  **Merchant ID** tá»« dashboard

### BÆ°á»›c 2: ThÃªm tÃ i khoáº£n vÃ o há»‡ thá»‘ng

1. ÄÄƒng nháº­p vá»›i quyá»n Admin
2. VÃ o menu **Káº¿ toÃ¡n** â†’ **Quáº£n lÃ½ tÃ i khoáº£n ngÃ¢n hÃ ng**
3. Click **ThÃªm tÃ i khoáº£n**
4. Äiá»n thÃ´ng tin:
   - **NgÃ¢n hÃ ng**: Chá»n ngÃ¢n hÃ ng (MBBank, VCB, ACB...)
   - **Sá»‘ tÃ i khoáº£n**: Sá»‘ tÃ i khoáº£n ngÃ¢n hÃ ng
   - **TÃªn tÃ i khoáº£n**: TÃªn chá»§ tÃ i khoáº£n
   - **Ghi chÃº**: MÃ´ táº£ (tÃ¹y chá»n)
   - **SePay API Token**: Token tá»« SePay (quan trá»ng!)
   - **SePay Merchant ID**: Merchant ID tá»« SePay (tÃ¹y chá»n)
   - **KÃ­ch hoáº¡t**: Báº­t Ä‘á»ƒ sá»­ dá»¥ng
   - **Äáº·t lÃ m máº·c Ä‘á»‹nh**: TÃ i khoáº£n máº·c Ä‘á»‹nh sáº½ Ä‘Æ°á»£c dÃ¹ng cho thanh toÃ¡n

### BÆ°á»›c 3: Äáº·t tÃ i khoáº£n lÃ m máº·c Ä‘á»‹nh

- Chá»‰ cÃ³ **1 tÃ i khoáº£n máº·c Ä‘á»‹nh** táº¡i má»™t thá»i Ä‘iá»ƒm
- TÃ i khoáº£n máº·c Ä‘á»‹nh sáº½ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ:
  - Táº¡o mÃ£ QR thanh toÃ¡n
  - Nháº­n webhook tá»« SePay
  - XÃ¡c thá»±c giao dá»‹ch

### BÆ°á»›c 4: Chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c tÃ i khoáº£n

Khi muá»‘n Ä‘á»•i sang tÃ i khoáº£n khÃ¡c:
1. Click icon â­ (ngÃ´i sao) bÃªn cáº¡nh tÃ i khoáº£n muá»‘n dÃ¹ng
2. TÃ i khoáº£n Ä‘Ã³ sáº½ trá»Ÿ thÃ nh máº·c Ä‘á»‹nh
3. Táº¥t cáº£ thanh toÃ¡n má»›i sáº½ dÃ¹ng tÃ i khoáº£n nÃ y

## ğŸ”§ TÃ­nh nÄƒng

### Quáº£n lÃ½ tÃ i khoáº£n

- âœ… **ThÃªm/Sá»­a/XÃ³a** tÃ i khoáº£n ngÃ¢n hÃ ng
- âœ… **KÃ­ch hoáº¡t/Táº¡m dá»«ng** tÃ i khoáº£n
- âœ… **Äáº·t lÃ m máº·c Ä‘á»‹nh** - chá»‰ 1 tÃ i khoáº£n máº·c Ä‘á»‹nh
- âœ… **LÆ°u SePay Token** riÃªng cho tá»«ng tÃ i khoáº£n
- âœ… **Badge hiá»ƒn thá»‹**:
  - ğŸŸ¡ **Máº·c Ä‘á»‹nh**: TÃ i khoáº£n Ä‘ang dÃ¹ng
  - ğŸŸ¢ **KÃ­ch hoáº¡t**: TÃ i khoáº£n sáºµn sÃ ng (khÃ´ng pháº£i máº·c Ä‘á»‹nh)
  - âš« **Táº¡m dá»«ng**: TÃ i khoáº£n khÃ´ng dÃ¹ng

### Thanh toÃ¡n

- Khi khÃ¡ch hÃ ng táº¡o Ä‘Æ¡n hÃ ng:
  - Há»‡ thá»‘ng láº¥y tÃ i khoáº£n **máº·c Ä‘á»‹nh**
  - Táº¡o mÃ£ QR vá»›i thÃ´ng tin tÃ i khoáº£n Ä‘Ã³
  - LÆ°u thÃ´ng tin tÃ i khoáº£n vÃ o payment

- Khi nháº­n webhook tá»« SePay:
  - Há»‡ thá»‘ng láº¥y **API Token** tá»« tÃ i khoáº£n máº·c Ä‘á»‹nh
  - XÃ¡c thá»±c webhook (náº¿u cÃ³ token)
  - Cáº­p nháº­t tráº¡ng thÃ¡i thanh toÃ¡n

## ğŸ“ Files Ä‘Ã£ cáº­p nháº­t

### Backend
- `BankAccount.java`: ThÃªm `sepayApiToken` vÃ  `sepayMerchantId`
- `BankAccountRequest.java`: ThÃªm fields cho SePay
- `BankAccountResponse.java`: ThÃªm fields cho SePay
- `PaymentServiceImpl.java`: Sá»­ dá»¥ng token tá»« bank account thay vÃ¬ config

### Frontend
- `app/admin/bank-accounts/page.tsx`: ThÃªm input fields cho SePay token

## ğŸ” Báº£o máº­t

- API Token Ä‘Æ°á»£c lÆ°u trong database (nÃªn mÃ£ hÃ³a trong production)
- Chá»‰ Admin má»›i cÃ³ quyá»n xem/sá»­a tÃ i khoáº£n ngÃ¢n hÃ ng
- Token Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ xÃ¡c thá»±c webhook tá»« SePay

## ğŸ’¡ Tips

1. **LuÃ´n cÃ³ tÃ i khoáº£n máº·c Ä‘á»‹nh**: Äáº£m báº£o cÃ³ Ã­t nháº¥t 1 tÃ i khoáº£n Ä‘Æ°á»£c Ä‘áº·t lÃ m máº·c Ä‘á»‹nh
2. **Nháº­p Ä‘Ãºng token**: Token sai sáº½ khiáº¿n webhook khÃ´ng hoáº¡t Ä‘á»™ng
3. **Test trÆ°á»›c khi dÃ¹ng**: Thá»­ thanh toÃ¡n nhá» Ä‘á»ƒ kiá»ƒm tra webhook
4. **Backup token**: LÆ°u token á»Ÿ nÆ¡i an toÃ n phÃ²ng trÆ°á»ng há»£p máº¥t

## ğŸ› Troubleshooting

### Webhook khÃ´ng hoáº¡t Ä‘á»™ng?
- âœ… Kiá»ƒm tra tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ trÃªn SePay chÆ°a
- âœ… Kiá»ƒm tra API Token Ä‘Ã£ nháº­p Ä‘Ãºng chÆ°a
- âœ… Kiá»ƒm tra tÃ i khoáº£n Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t lÃ m máº·c Ä‘á»‹nh chÆ°a
- âœ… Kiá»ƒm tra tÃ i khoáº£n Ä‘ang á»Ÿ tráº¡ng thÃ¡i "KÃ­ch hoáº¡t"

### KhÃ´ng táº¡o Ä‘Æ°á»£c QR code?
- âœ… Kiá»ƒm tra cÃ³ tÃ i khoáº£n máº·c Ä‘á»‹nh chÆ°a
- âœ… Kiá»ƒm tra thÃ´ng tin tÃ i khoáº£n (sá»‘ TK, tÃªn TK) Ä‘Ã£ Ä‘Ãºng chÆ°a

### Muá»‘n Ä‘á»•i tÃ i khoáº£n nháº­n tiá»n?
- âœ… Click icon â­ bÃªn cáº¡nh tÃ i khoáº£n muá»‘n dÃ¹ng
- âœ… TÃ i khoáº£n Ä‘Ã³ sáº½ trá»Ÿ thÃ nh máº·c Ä‘á»‹nh ngay láº­p tá»©c
